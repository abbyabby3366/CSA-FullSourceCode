<!DOCTYPE html>
<html lang="en" data-layout="vertical" data-topbar="light" data-sidebar="dark" data-sidebar-size="lg" data-sidebar-image="none" data-preloader="disable">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Survey Details | Member Portal</title>

    <script src="../assets/js/layout.js"></script>

    <!-- bootstrap css -->
    <link rel="stylesheet" href="../assets/css/bootstrap.css">

    <!-- font css -->
	<link rel="stylesheet" href="../assets/css/icons.min.css">

    <!-- app css -->
	<link rel="stylesheet" href="../assets/css/app.min.css" />

    <!-- custom css -->
	<link rel="stylesheet" href="../assets/css/custom.css">

    <!-- select2 css -->
    <link rel="stylesheet" href="../assets/libs/select2/css/select2.min.css" />
    <link rel="stylesheet" href="../assets/libs/select2/css/select2-bootstrap-5-theme.min.css" />

    <style>
        .navbar-menu {
            background: #279d69 !important;
        }

        .menu-title {
            color: white !important;
        }

        .navbar-menu .navbar-nav .nav-link {
            color: lightyellow !important;
        }

        .no-border {
            border: none !important;
            background: transparent !important;
            box-shadow: none !important;
            padding-left: 0 !important;
        }

        .readonly-select {
            pointer-events: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }

        .select2-container--bootstrap-5.select2-container--disabled .select2-selection {
            background-color: transparent !important;
            border: none !important;
        }

        .section-title {
            font-weight: 800;
            border-bottom: solid 1px #ebeef0;
            font-size: 15px;
            width: 100%;
            margin-bottom: 20px;
            padding-bottom: 5px;
            color: #279d69;
            text-transform: uppercase;
        }

        #survey-loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 400px;
        }

        .loader-survey {
            width: 48px;
            height: 48px;
            border: 5px solid #279d69;
            border-bottom-color: transparent;
            border-radius: 50%;
            display: inline-block;
            box-sizing: border-box;
            animation: rotation 1s linear infinite;
        }

        @keyframes rotation {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>

    <link href="../assets/images/logos/favicon.ico" rel="shortcut icon" type="image/x-icon" />
</head>
<body>
    <div class="layout-wrapper">
        <!-- page header -->
        <header id="page-topbar"></header>					
        
        <div class="app-menu navbar-menu"></div>
        
        <div class="vertical-overlay"></div>

        <div class="main-content">
            <div class="page-content">
                <div class="container-fluid">
                    <!-- page header -->
                    <div class="row mb-3 pb-1">
                        <div class="col-12">
                            <div class="d-flex align-items-lg-center flex-lg-row flex-column">
                                <div class="flex-grow-1">
                                    <h4 class="fs-16 mb-1">Survey Details: YABAM</h4>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-lg-12">
                            <div class="card">
                                <div class="card-body p-4 text-center" id="survey-loading">
                                    <span class="loader-survey"></span>
                                    <h5 class="mt-4 text-primary">Memuat Turun Maklumat...</h5>
                                    <p class="text-muted">Sila tunggu sebentar sementara kami memproses data anda.</p>
                                </div>
                                <div class="card-body d-none" id="survey-content">
                                    <ul class="nav nav-tabs mb-4" role="tablist">
                                        <li class="nav-item" role="presentation">
                                            <a class="nav-link active" data-bs-toggle="tab" href="#bagA" role="tab" aria-selected="true">
                                                Bahagian A
                                            </a>
                                        </li>
                                        <li class="nav-item" role="presentation">
                                            <a class="nav-link" data-bs-toggle="tab" href="#bagB" role="tab" aria-selected="false">
                                                Bahagian B
                                            </a>
                                        </li>
                                        <li class="nav-item" role="presentation">
                                            <a class="nav-link" data-bs-toggle="tab" href="#bagC" role="tab" aria-selected="false">
                                                Bahagian C
                                            </a>
                                        </li>
                                    </ul>

                                    <div class="tab-content">
                                        <!-- Bahagian A -->
                                        <div class="tab-pane active" id="bagA" role="tabpanel">
                                            <div class="section-title">Informasi Demografi</div>
                                            
                                            <div class="mb-4">
                                                <label class="form-label d-block fw-semibold mb-1">1. Negeri manakah yang anda tinggal sekarang?</label>
                                                <p class="mb-0 text-muted">Selangor</p>
                                            </div>

                                            <div class="mb-4">
                                                <label class="form-label d-block fw-semibold mb-1">2. Apakah jawatan/ posisi anda di tempat kerja?</label>
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <p class="mb-0 text-muted">Sektor Awam -> Pegawai Eksekutif</p>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="mb-4">
                                                <label class="form-label d-block fw-semibold mb-1">3. Apakah Taraf Pendidikan Anda?</label>
                                                <p class="mb-0 text-muted">Ijazah</p>
                                            </div>

                                            <div class="mb-4">
                                                <label class="form-label d-block fw-semibold mb-1">4. Apakah status perkahwinan anda?</label>
                                                <p class="mb-0 text-muted">Berkahwin</p>
                                            </div>

                                            <div class="mb-4">
                                                <label class="form-label d-block fw-semibold mb-1">5. Berapakah jumlah tanggungan anda termasuk diri sendiri?</label>
                                                <p class="mb-0 text-muted">4</p>
                                            </div>

                                            <div class="mb-4">
                                                <label class="form-label d-block fw-semibold mb-1">6. Adakah anda mempunyai tanggungan ahli keluarga OKU atau sakit tenat?</label>
                                                <p class="mb-0 text-muted">Tidak</p>
                                            </div>

                                            <div class="mb-4">
                                                <label class="form-label d-block fw-semibold mb-1">7. Adakah anda mempunyai rumah sendiri atau menyewa?</label>
                                                <p class="mb-0 text-muted">Memiliki rumah sendiri</p>
                                            </div>

                                            <div class="mb-4">
                                                <label class="form-label d-block fw-semibold mb-1">8. Dimanakah lokasi kediaman rumah anda?</label>
                                                <p class="mb-0 text-muted">Dalam Bandar</p>
                                            </div>

                                            <div class="mb-4">
                                                <label class="form-label d-block fw-semibold mb-1">9. Berapakah jumlah kerata yang anda miliki?</label>
                                                <p class="mb-0 text-muted">2</p>
                                            </div>

                                            <div class="mb-4">
                                                <label class="form-label d-block fw-semibold mb-1">10. Apakah hobi/ minat anda ketika waktu lapang?</label>
                                                <ul class="text-muted mb-0">
                                                    <li>Menonton TV atau filem</li>
                                                    <li>Membaca atau menulis</li>
                                                    <li>Melancong atau berkelah</li>
                                                </ul>
                                            </div>
                                        </div>

                                        <!-- Bahagian B -->
                                        <div class="tab-pane" id="bagB" role="tabpanel">
                                            <div class="section-title">Kestabilan Kewangan</div>

                                            <div class="mb-4">
                                                <label class="form-label d-block fw-semibold mb-1">11. Berapakah jumlah pendapatan kasar sekeluarga anda?</label>
                                                <p class="mb-0 text-muted">RM5,001 - RM10,000</p>
                                            </div>

                                            <div class="mb-4">
                                                <label class="form-label d-block fw-semibold mb-1">12. Berapa banyak hutang anda buat masa sekarang?</label>
                                                <p class="mb-0 text-muted">RM100,001 - RM200,000</p>
                                            </div>

                                            <div class="mb-4">
                                                <label class="form-label d-block fw-semibold mb-1">13. Berapakah simpanan anda sebulan?</label>
                                                <p class="mb-0 text-muted">RM401 - RM700</p>
                                            </div>

                                            <div class="mb-4">
                                                <label class="form-label d-block fw-semibold mb-1">14. Apakah yang mendorong anda untuk menabung?</label>
                                                <ul class="text-muted mb-0">
                                                    <li>Menyediakan dana kecemasan</li>
                                                    <li>Persediaan untuk persaraan</li>
                                                    <li>Menjamin masa depan pendidikan anak-anak</li>
                                                </ul>
                                            </div>

                                            <div class="mb-4">
                                                <label class="form-label d-block fw-semibold mb-1">15. Apakah cabaran paling sukar untuk menabung?</label>
                                                <ul class="text-muted mb-0">
                                                    <li>Kos sara hidup yang tinggi</li>
                                                    <li>Komitmen hutang yang tinggi</li>
                                                    <li>Kecemasan atau perbelanjaan tidak dijangka</li>
                                                </ul>
                                            </div>

                                            <div class="mb-4">
                                                <label class="form-label d-block fw-semibold mb-1">16. Berapa kerap anda terpaksa meminjam wang untuk menampung perbelanjaan harian?</label>
                                                <p class="mb-0 text-muted">Sekali atau dua kali</p>
                                            </div>

                                            <div class="mb-4">
                                                <label class="form-label d-block fw-semibold mb-1">17. Apakah ketakutan anda dalam menambah komitmen kewangan?</label>
                                                <p class="mb-0 text-muted">Beban kewangan yang bertambah dan menjejaskan gaya hidup</p>
                                            </div>
                                        </div>

                                        <!-- Bahagian C -->
                                        <div class="tab-pane" id="bagC" role="tabpanel">
                                            <div class="section-title">Perancangan & Susulan</div>

                                            <div class="mb-4">
                                                <label class="form-label d-block fw-semibold mb-1">21. Siapakah guru kewangan yang paling anda minati?</label>
                                                <p class="mb-0 text-muted">Dr Adam Zubir</p>
                                            </div>

                                            <div class="mb-4">
                                                <label class="form-label d-block fw-semibold mb-1">22. Bilakah anda selesa untuk dihubungi bagi sesi perbualan lanjut?</label>
                                                <p class="mb-0 text-muted">Malam</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-footer text-end d-none" id="survey-footer">
                                    <a href="survey.html" class="btn btn-soft-secondary">Back to Surveys</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <footer class="footer">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-sm-6">
                            © Hak Cipta <script>document.write(new Date().getFullYear())</script> © YAYASAN AMANAH BANTUAN AWAM MALAYSIA - Hak cipta terpelihara.
                        </div>
                        <div class="col-sm-6">
                            <div class="text-sm-end d-none d-sm-block">
                                Design & Develop by Epic Unicorn
                            </div>
                        </div>
                    </div>
                </div>
            </footer>
        </div>
    </div>

    <!-- jquery js -->
    <script src="../assets/libs/jquery/js/jquery-3.6.3.min.js"></script>

    <!-- bootstrap js -->
    <script src="../assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- utils js -->
    <script src="../assets/libs/simplebar/simplebar.min.js"></script>
    <script src="../assets/libs/node-waves/waves.min.js"></script>

    <!-- font js -->
    <script src="../assets/libs/feather-icons/feather.min.js"></script>
    <script src="../assets/js/pages/plugins/lord-icon-2.1.0.js"></script>

    <!-- select2 js -->
    <script src="../assets/libs/select2/js/select2.min.js"></script>

    <!-- Navigation & UI js -->
    <script src="navbar-member.js"></script>
    <script src="memberHelper.js"></script>
    <script src="../assets/js/app.js"></script>

    <script>
        $(document).ready(async function() {
            // initMemberPortal is already called by memberHelper.js on document ready,
            // but we need the member data here. memberHelper.js stores it in window.currentMember.
            
            // Wait a bit for the portal to initialize if it hasn't yet
            let member = window.currentMember;
            if (!member) {
                member = await initMemberPortal();
            }
            const token = localStorage.getItem('token');

            if (member) {
                try {
                    const response = await fetch('http://localhost:5000/api/surveys/me', {
                        headers: { 'x-auth-token': token }
                    });
                    const survey = await response.json();
                    
                    $('#survey-loading').addClass('d-none');
                    
                    if (survey) {
                        $('#survey-content, #survey-footer').removeClass('d-none');
                        // Bahagian A
                        $('#bagA p').eq(0).text(survey.section1.state);
                        $('#bagA p').eq(1).text(survey.section1.jobPositionCategory + ' -> ' + survey.section1.jobPositionLevel);
                        
                        // We might need to add placeholders for other fields if they exist in the model
                        // For now, mapping what we have
                        
                        // Bahagian B
                        $('#bagB p').eq(0).text(survey.section2.familyIncome);
                        $('#bagB p').eq(1).text(survey.section2.debtRange);

                        // Bahagian C
                        $('#bagC p').eq(0).text(survey.finalSection.favoriteGuru);
                        
                        // Update section titles or other static-looking text if needed
                    } else {
                        alert('No survey data found.');
                        window.location.href = 'survey.html';
                    }
                } catch (err) {
                    console.error('Error fetching survey details:', err);
                    $('#survey-loading').html('<div class="alert alert-danger">Error loading data. Please try again later.</div>');
                }
            }
        });
    </script>
</body>
</html>
