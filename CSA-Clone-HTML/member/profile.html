<!DOCTYPE html>
<html lang="en" data-layout="vertical" data-topbar="light" data-sidebar="dark" data-sidebar-size="lg" data-sidebar-image="none" data-preloader="disable">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Profile | Member Portal</title>

    <script src="../assets/js/layout.js"></script>

    <!-- bootstrap css -->
    <link rel="stylesheet" href="../assets/css/bootstrap.css">

    <!-- font css -->
	<link rel="stylesheet" href="../assets/css/icons.min.css">

    <!-- app css -->
	<link rel="stylesheet" href="../assets/css/app.min.css" />

    <!-- custom css -->
	<link rel="stylesheet" href="../assets/css/custom.css">

    <!-- SweetAlert2 -->
    <link rel="stylesheet" href="../assets/libs/sweetalert2/sweetalert2.min.css">

    <style>
        .navbar-menu {
            background: #279d69 !important;
        }

        .menu-title {
            color: white !important;
        }

        .navbar-menu .navbar-nav .nav-link {
            color: lightyellow !important;
        }

        .profile-wid-bg {
            height: 300px;
        }

        .profile-wid-bg::before {
            background: #279d69 !important;
            background: -webkit-gradient(linear,left bottom,left top,from(whitesmoke),to(#279d69)) !important;
            background: linear-gradient(to top,white,#279d69) !important;
        }

        span.circle_icon {
            background: #efefef;
            border-radius: 50%;
            display: inline-block;
            padding: 0.65rem;
            text-align: center;
            vertical-align: middle;
            line-height: 0.95rem;
            width: 38px;
            height: 38px;
        }
    </style>

    <link href="../assets/images/logos/favicon.ico" rel="shortcut icon" type="image/x-icon" />
</head>
<body>
    <div class="layout-wrapper">
        <!-- page header -->
        <header id="page-topbar"></header>					
        
        <div class="app-menu navbar-menu"></div>
        
        <div class="vertical-overlay"></div>

        <div class="main-content">
            <div class="page-content">
                <div class="container-fluid">
                    <div class="profile-foreground position-relative mx-n4 mt-n4">
                        <div class="profile-wid-bg">
                            <img src="../assets/images/profile-bg.jpg" alt="" class="profile-wid-img" />
                        </div>
                    </div>

                    <div class="pt-4 mb-4 mb-lg-3 pb-lg-4 profile-wrapper">
                        <div class="row justify-content-center mt-4 mb-4">
                            <div class="col-mx text-center">
                                <div class="profile-user position-relative d-inline-block mx-auto mb-4">
                                    <img src="../assets/images/users/user-dummy-img.jpg" class="rounded-circle avatar-xl img-thumbnail user-profile-image" alt="user-profile-image" id="profileImg">
                                </div>
                                <h3 class="text-white mb-1" id="headerFullName">Member User</h3>
                                <div class="text-white text-opacity-75">
                                    <i class="ri-map-pin-user-line me-1 text-white text-opacity-75 fs-16 align-middle"></i> <span id="headerEmail">member@example.com</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-lg-8">
                            <div class="card mt-n4">
                                <div class="card-header align-items-center d-flex">
                                    <h5 class="card-title mb-0 flex-grow-1"><i class="ri-account-pin-box-line"></i> User Details</h5>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-borderless mb-0">
                                            <tbody>
                                                <tr>
                                                    <th class="ps-0" scope="row" style="width:200px">User ID</th>
                                                    <td class="text-muted" id="userId">USR12345</td>
                                                </tr>
                                                <tr>
                                                    <th class="ps-0" scope="row">Account Status</th>
                                                    <td class="text-muted" id="accountStatus"><span class="badge bg-success">Active</span></td>
                                                </tr>
                                                <tr>
                                                    <th class="ps-0" scope="row">Referral Name</th>
                                                    <td class="text-muted" id="referralName">Referrer Agent</td>
                                                </tr>
                                                <tr>
                                                    <th class="ps-0" scope="row">Full Name</th>
                                                    <td class="text-muted" id="fullName">Member User</td>
                                                </tr>
                                                <tr>
                                                    <th class="ps-0" scope="row">NIRC</th>
                                                    <td class="text-muted" id="icNumber">900101-10-1234</td>
                                                </tr>
                                                <tr>
                                                    <th class="ps-0" scope="row">Email Address</th>
                                                    <td class="text-muted" id="email">member@example.com</td>
                                                </tr>
                                                <tr>
                                                    <th class="ps-0" scope="row">Gender</th>
                                                    <td class="text-muted" id="gender">Male</td>
                                                </tr>
                                                <tr>
                                                    <th class="ps-0" scope="row">Phone No</th>
                                                    <td class="text-muted" id="phoneNumber">+60 123456789</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                <div class="card-header align-items-center d-flex border-top">
                                    <h5 class="card-title mb-0 flex-grow-1"><i class="ri-bank-card-line"></i> Bank Details</h5>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-borderless mb-0">
                                            <tbody>
                                                <tr>
                                                    <th class="ps-0" scope="row" style="width:200px">Bank Name</th>
                                                    <td class="text-muted" id="bankName">Maybank</td>
                                                </tr>
                                                <tr>
                                                    <th class="ps-0" scope="row">Bank Account Name</th>
                                                    <td class="text-muted" id="bankAccountName">Member User</td>
                                                </tr>
                                                <tr>
                                                    <th class="ps-0" scope="row">Bank Account Number</th>
                                                    <td class="text-muted" id="bankAccountNumber">164XXXXXXXXX</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-4">
                            <div class="card mt-n4">
                                <div class="card-body">
                                    <div class="d-flex align-items-center">
                                        <div class="flex-shrink-0">
                                            <span class="circle_icon"><i class="ri-wallet-line text-primary"></i></span>
                                        </div>
                                        <div class="flex-grow-1 ms-3">
                                            <h6 class="fs-14 mb-1">Ganjaran</h6>
                                            <p class="text-muted mb-0">Total Rewards</p>
                                        </div>
                                        <div class="flex-shrink-0 text-end">
                                            <h6 class="fs-16 fw-semibold m-0" id="walletCash">RM 0.00</h6>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="card">
                                <div class="card-body">
                                    <div class="d-flex align-items-center">
                                        <div class="flex-shrink-0">
                                            <span class="circle_icon"><i class="ri-user-add-line text-success"></i></span>
                                        </div>
                                        <div class="flex-grow-1 ms-3">
                                            <h6 class="fs-14 mb-1">Peserta</h6>
                                            <p class="text-muted mb-0">Total Referrals</p>
                                        </div>
                                        <div class="flex-shrink-0 text-end">
                                            <h6 class="fs-16 fw-semibold m-0" id="referralCount">0</h6>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="card">
                                <div class="card-body">
                                    <h5 class="card-title mb-3">Registration Link</h5>
                                    <div class="input-group">
                                        <input type="text" class="form-control" value="/member/register.html?ref=MEM00567" readonly id="refLink">
                                        <button class="btn btn-outline-primary" type="button" onclick="copyRef()"><i class="ri-file-copy-line"></i></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <footer class="footer">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-sm-6">
                            © Hak Cipta <script>document.write(new Date().getFullYear())</script> © YAYASAN AMANAH BANTUAN AWAM MALAYSIA - Hak cipta terpelihara.
                        </div>
                        <div class="col-sm-6">
                            <div class="text-sm-end d-none d-sm-block">
                                Design & Develop by Epic Unicorn
                            </div>
                        </div>
                    </div>
                </div>
            </footer>
        </div>
    </div>

    <!-- jquery js -->
    <script src="../assets/libs/jquery/js/jquery-3.6.3.min.js"></script>
    <script src="../Scripts/config.js"></script>

    <!-- bootstrap js -->
    <script src="../assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- utils js -->
    <script src="../assets/libs/simplebar/simplebar.min.js"></script>
    <script src="../assets/libs/node-waves/waves.min.js"></script>

    <!-- font js -->
    <script src="../assets/libs/feather-icons/feather.min.js"></script>
    <script src="../assets/js/pages/plugins/lord-icon-2.1.0.js"></script>

    <!-- App js -->
    <script src="../assets/js/app.js"></script>
    <script src="navbar-member.js"></script>
    <script src="memberHelper.js"></script>

    <!-- SweetAlert2 JS -->
    <script src="../assets/libs/sweetalert2/sweetalert2.all.min.js"></script>

    <script>
        $(document).ready(async function() {
            const member = await initMemberPortal();
            if (member) {
                const formatValue = (val) => (val === null || val === undefined || val === '') ? '-' : val;
                
                // Header Info
                $('#headerFullName').text(member.firstName + ' ' + member.lastName);
                $('#headerEmail').text(formatValue(member.email));
                if (member.profileImage) {
                    $('#profileImg').attr('src', `${window.API_BASE_URL}/` + member.profileImage);
                }

                // Table Details
                $('#userId').text('USR' + member.memberCode);
                
                // Status Badge
                let statusHtml = '';
                if (member.status === 1) statusHtml = '<span class="badge bg-warning">Waiting Approval</span>';
                else if (member.status === 2) statusHtml = '<span class="badge bg-success">Active</span>';
                else statusHtml = '<span class="badge bg-danger">Inactive</span>';
                $('#accountStatus').html(statusHtml);

                $('#referralName').text(member.referrer ? `${member.referrer.firstName} ${member.referrer.lastName} (${member.referrer.memberCode})` : '-');
                $('#fullName').text(member.firstName + ' ' + member.lastName);
                $('#icNumber').text(formatValue(member.icNumber));
                $('#email').text(formatValue(member.email));
                $('#gender').text(formatValue(member.gender));
                $('#phoneNumber').text('+60 ' + formatValue(member.phoneNumber));

                // Bank Details
                $('#bankName').text(formatValue(member.bankName));
                $('#bankAccountName').text(formatValue(member.bankAccountName));
                $('#bankAccountNumber').text(formatValue(member.bankAccountNumber));

                // Cards Info
                $('#walletCash').text('RM ' + (member.walletCash || 0).toLocaleString(undefined, {minimumFractionDigits: 2}));
                $('#referralCount').text(member.referralCount || 0);

                // Referral Link
                const relativePath = window.location.pathname.split('/').slice(0, -1).join('/'); // Gets the directory path
                const referralUrl = window.location.origin + relativePath + '/register.html?ref=' + member.memberCode;
                $('#refLink').val(referralUrl);
            }
        });

        function copyRef() {
            var copyText = document.getElementById("refLink");
            copyText.select();
            copyText.setSelectionRange(0, 99999);
            document.execCommand("copy");
            
            Swal.fire({
                toast: true,
                position: 'top-end',
                icon: 'success',
                title: 'Link Copied',
                showConfirmButton: false,
                timer: 3000,
                timerProgressBar: true
            });
        }
    </script>
</body>
</html>
